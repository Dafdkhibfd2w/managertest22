<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap" rel="stylesheet">


  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NEW DELI â€¢ × ×™×”×•×œ ×¡×¤×§×™×</title>
  <link rel="stylesheet" href="/css/style.css?v=2" />
  <link rel="icon" href="/icons/icon-512.png" type="image/png">
<script src="https://unpkg.com/lucide@latest"></script>


  
  <script defer src="/js/ui.js"></script>
</head>
<header class="brandbar">
  <span class="brand-title">NEW DELI</span>
  <div class="brandbar-right">
    <button id="notifToggle" class="icon-btn">
      <i data-lucide="bell-off"></i>
    </button>
    <span class="burger" id="burger">&#9776;</span>
  </div>
</header>



<nav class="mobile-nav" id="mobileNav">
  <button id="closeNav" class="close-btn">âœ–</button>
  <ul>
    <li><a href="/"><span class="icon">ğŸ </span> ×“×£ ×”×‘×™×ª</a></li>
    <li><a href="/create"><span class="icon">ğŸ—“ï¸</span> ×™×¦×™×¨×ª ××©××¨×ª</a></li>
    <li><a href="/manage"><span class="icon">âœ…</span> × ×™×”×•×œ ××©××¨×ª</a></li>
    <li><a href="/admin-login"><span class="icon">ğŸ“š</span> ××¨×›×™×•×Ÿ / ×“×©×‘×•×¨×“ ×× ×”×œ</a></li>
    <li><a href="/invoices-page"><span class="icon">ğŸ§¾</span> ×—×©×‘×•× ×™×•×ª</a></li>
    <li><a href="/suppliers-page"><span class="icon">ğŸ·ï¸</span> ×¡×¤×§×™×</a></li>
    <li><a href="/orders-page"><span class="icon">ğŸ“¦</span> ×”×–×× ×•×ª</a></li>
    <li><a href="/dispersals-page"><span class="icon">ğŸš•</span> ×¤×™×–×•×¨×™×</a></li>
  </ul>
</nav>
  <div class="wrap">
    <h1>× ×™×”×•×œ ×¡×¤×§×™×</h1>

    <!-- ×˜×•×¤×¡ ×”×•×¡×¤×”/×¢×¨×™×›×” -->
<div class="section">
  <h3 id="formTitle" style="color: var(--muted);">×”×•×¡×£ ×¡×¤×§</h3>
  <form id="supplierForm">
    <div class="modal-grid">
      <div>
        <label for="name">×©× ×¡×¤×§</label>
        <input type="text" id="name" name="name" required />
      </div>
      <div>
        <label for="phone">×˜×œ×¤×•×Ÿ (×œ× ×—×•×‘×”)</label>
        <input type="text" id="phone" name="phone" placeholder="050-0000000" />
      </div>
      <!-- <div>
        <label for="active">×¡×˜×˜×•×¡</label>
        <select id="active" name="active">
          <option value="true" selected>×¤×¢×™×œ</option>
          <option value="false">×œ× ×¤×¢×™×œ</option>
        </select>
      </div> -->
    </div>

    <div class="section">
      <label>×™××™ ×¤×¢×™×œ×•×ª</label>
<div class="task-tabs">
  <label class="check-label" style="padding:10px; border-radius: 20px; background: rgba(0, 255, 163, 0.08);">
    <input type="checkbox" class="day styled-checkbox" value="0">
    <span class="day-text">×'</span>
  </label>
  <label class="check-label" style="padding:10px; border-radius: 20px; background: rgba(0, 255, 163, 0.08);">
    <input type="checkbox" class="day styled-checkbox" value="1">
    <span class="day-text">×‘'</span>
  </label>
  <label class="check-label" style="padding:10px; border-radius: 20px; background: rgba(0, 255, 163, 0.08);">
    <input type="checkbox" class="day styled-checkbox" value="2">
    <span class="day-text">×’'</span>
  </label>
  <label class="check-label" style="padding:10px; border-radius: 20px; background: rgba(0, 255, 163, 0.08);">
    <input type="checkbox" class="day styled-checkbox" value="3">
    <span class="day-text">×“'</span>
  </label>
  <label class="check-label" style="padding:10px; border-radius: 20px; background: rgba(0, 255, 163, 0.08);">
    <input type="checkbox" class="day styled-checkbox" value="4">
    <span class="day-text">×”'</span>
  </label>
</div>

    </div>

    <div class="section">
      <label>××•×¦×¨×™×</label>
      <div class="items-grid" id="itemsGrid" style="display: grid; gap: 12px;">
        <!-- ×™×ª×•×•×¡×¤×• ×¤×¨×™×˜×™× ×“×™× ××™×ª -->
      </div>
      <button type="button" id="addItem" class="secondary" style="margin-top: 10px;">×”×•×¡×£ ××•×¦×¨</button>
    </div>

    <div class="modal-actions" style="margin-top: 20px;">
      <button type="submit" class="btn save">×©××•×¨</button>
      <button type="button" id="resetForm" class="btn cancel" style="margin-top: 10px;">× ×§×” ×˜×•×¤×¡</button>
    </div>
    <p class="muted" id="msg"></p>
  </form>
</div>


    <!-- ×˜×‘×œ×ª ×¡×¤×§×™× -->
    <div class="card">
      <div style="display:flex; gap:8px; align-items:center; justify-content:space-between;">
        <h3 style="margin:0">×¡×¤×§×™×</h3>
      </div>
      <div style="overflow:auto; margin-top:10px;">
<table id="tbl" class="responsive-table">
<thead>
  <tr>
    <th>×©×</th>
    <th>×˜×œ×¤×•×Ÿ</th>
    <th>×™××™×</th>
    <th>××•×¦×¨×™×</th>
    <th style="width:160px">×¤×¢×•×œ×•×ª</th>
  </tr>
</thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <p class="muted">×©×™× ×•×™×™ ×¡×¤×§×™× ×™×©×¤×™×¢×• ×¢×œ ×™×¦×™×¨×ª ×˜×•×¤×¡ ×”×–×× ×•×ª ×—×“×© ×œ×™×•× ×¨×œ×•×•× ×˜×™. ×× ×›×‘×¨ × ×•×¦×¨ ×˜×•×¤×¡ ×œ×™×•× ××¡×•×™×, ××¤×©×¨ â€œ×œ×¨×¢× ×Ÿ ×œ×¤×™ ×¡×¤×§×™×â€.</p>
  </div>

  <script>
    const form = document.getElementById('supplierForm');
    const formTitle = document.getElementById('formTitle');
    const msg  = document.getElementById('msg');
    const tblBody = document.querySelector('#tbl tbody');
    const itemsGrid = document.getElementById('itemsGrid');
    const addItemBtn = document.getElementById('addItem');

    const nameEl = document.getElementById('name');
    const phoneEl = document.getElementById('phone');
    // const activeEl = document.getElementById('active');
    const dayEls = Array.from(document.querySelectorAll('.day'));


    let editingId = null;
    let currentList = [];

    function dayLabel(n){
      return ['××³','×‘×³','×’×³','×“×³','×”×³','×•×³','×©×³'][n] || n;
    }

    function renderItems(items){
      itemsGrid.innerHTML = '';
      (items || []).forEach((it, idx) => addItemRow(it.name, it.unit));
      if (!items || !items.length) addItemRow('','');
    }

function addItemRow(name = '', unit = '') {
  const row = document.createElement('div');
  row.className = 'item-row'; // ×—×©×•×‘ ×××•×“!

  row.innerHTML = `
    <input type="text" placeholder="×©× ××•×¦×¨" value="${escapeAttr(name)}">
    <input type="text" placeholder="×™×—×™×“×” (×œ××©×œ: ×§×¨×˜×•×Ÿ)" value="${escapeAttr(unit)}">
    <button style="margin-top: 10px;" type="button" class="secondary">××—×§</button>
  `;

  const delBtn = row.querySelector('button');
  delBtn.onclick = () => row.remove();

  itemsGrid.appendChild(row);
}


    addItemBtn.onclick = () => addItemRow('','');

    function collectItems(){
      const rows = Array.from(itemsGrid.querySelectorAll('.item-row'));
      return rows.map(r => {
        const [n, u] = r.querySelectorAll('input');
        return { name: n.value.trim(), unit: u.value.trim() };
      }).filter(x => x.name);
    }

    function collectDays(){
      return dayEls.filter(el => el.checked).map(el => Number(el.value));
    }

    function setDays(days){
      dayEls.forEach(el => el.checked = Array.isArray(days) && days.includes(Number(el.value)));
    }

    function resetForm(){
      editingId = null;
      formTitle.textContent = '×”×•×¡×£ ×¡×¤×§';
      nameEl.value = '';
      phoneEl.value = '';
      // activeEl.value = 'true';
      setDays([]);
      renderItems([]);
      msg.textContent = '';
    }

    document.getElementById('resetForm').onclick = resetForm;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
const payload = {
  name: nameEl.value.trim(),
  phone: phoneEl.value.trim(),
  days: collectDays(),
  items: collectItems()
};
      try {
        msg.textContent = '×©×•××¨...';
        let res;
        if (editingId) {
          res = await fetch('/suppliers/' + editingId, {
            method:'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)
          });
        } else {
          res = await fetch('/suppliers', {
            method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)
          });
        }
        const data = await res.json();
        if (data.ok) {
          msg.textContent = '× ×©××¨ âœ”';
          await loadSuppliers();
          resetForm();
        } else {
          msg.textContent = data.message || '×©×’×™××” ×‘×©××™×¨×”';
        }
        setTimeout(()=> msg.textContent='', 1500);
      } catch (err) {
        msg.textContent = '×©×’×™××” ×‘×©××™×¨×”';
      }
    });

async function loadSuppliers(){
  const res = await fetch('/suppliers');
  const data = await res.json();
  currentList = data.suppliers || [];
  renderTable();
}


function renderTable(){
  tblBody.innerHTML = currentList.map(s => `
    <tr>
      <td data-label="×©×">${escapeHtml(s.name)}</td>
      <td data-label="×˜×œ×¤×•×Ÿ">${escapeHtml(s.phone) || '×œ× ×”×•×–×Ÿ'}</td>
      <td data-label="×™××™×">${(s.days||[]).map(dayLabel).join(', ')}</td>
      <td data-label="××•×¦×¨×™×">${(s.items||[]).map(it => escapeHtml(it.name)).join(', ')}</td>
      <td data-label="×¤×¢×•×œ×•×ª" class="actions">
        <button class="secondary" data-edit="${s._id}">×¢×¨×•×š</button>
        <button class="danger" data-del="${s._id}">××—×§</button>
      </td>
    </tr>
  `).join('');
}


    async function editSupplier(id){
      const s = currentList.find(x => x._id === id);
      if (!s) return;
      editingId = id;
      formTitle.textContent = '×¢×¨×™×›×ª ×¡×¤×§';
      nameEl.value = s.name || '';
      phoneEl.value = s.phone || '';
      // activeEl.value = s.active ? 'true' : 'false';
      setDays(s.days || []);
      renderItems(s.items || []);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    async function delSupplier(id){
      if (!confirm('×œ××—×•×§ ×¡×¤×§?')) return;
      await fetch('/suppliers/' + id, { method:'DELETE' });
      await loadSuppliers();
    }

    // async function toggleActive(id){
    //   const s = currentList.find(x => x._id === id);
    //   if (!s) return;
    //   await fetch('/suppliers/' + id + '/active', {
    //     method:'PATCH',
    //     headers:{'Content-Type':'application/json'},
    //     body: JSON.stringify({ active: !s.active })
    //   });
    //   await loadSuppliers();
    // }



    // Utils
    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m])); }
    function escapeAttr(s){ return escapeHtml(s).replace(/"/g,'&quot;'); }

    // init
    resetForm();
    loadSuppliers();
  </script>
  <script src="/js/global.js"></script>
<script src="/js/ui-enhance.js" defer></script>
  
</body>
</html>
