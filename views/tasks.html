<!DOCTYPE html>


<aside id="mobileNav" class="drawer mobile-nav"><div class="drawer-head"><div class="brand">Shift<span class="brand-accent">Pro</span></div><button class="icon-btn" id="closeNav"><svg data-lucide="x"></svg></button></div><nav class="drawer-nav"><a href="/" class="drawer-link"><svg data-lucide="home"></svg> דף הבית</a><a href="/task" class="drawer-link active"><svg data-lucide="list-todo"></svg> משימות</a></nav></aside>


<main class="wrap">
<h1>ניהול משימות</h1>


<section class="card">
<form id="addTaskForm" class="form-grid">
<div>
<label>קטגוריה</label>
<select name="category" required>
<option value="daily">יומי</option>
<option value="weekly">שבועי</option>
<option value="monthly">חודשי</option>
</select>
</div>
<div class="full">
<label>שם המשימה</label>
<input type="text" name="name" placeholder="לדוג׳: לסגור קופה" required />
</div>
<div class="actions right full">
<button class="btn primary" type="submit">הוסף משימה</button>
</div>
</form>
</section>


<section class="card">
<h3>משימות יומיות</h3>
<div class="table-wrap"><table class="table"><thead><tr><th>משימה</th><th>פעולות</th></tr></thead><tbody id="dailyTasks"><tr class="skeleton shimmer"><td colspan="2">&nbsp;</td></tr></tbody></table></div>
</section>


<section class="card">
<h3>משימות שבועיות</h3>
<div class="table-wrap"><table class="table"><thead><tr><th>משימה</th><th>פעולות</th></tr></thead><tbody id="weeklyTasks"><tr class="skeleton shimmer"><td colspan="2">&nbsp;</td></tr></tbody></table></div>
</section>


<section class="card">
<h3>משימות חודשיות</h3>
<div class="table-wrap"><table class="table"><thead><tr><th>משימה</th><th>פעולות</th></tr></thead><tbody id="monthlyTasks"><tr class="skeleton shimmer"><td colspan="2">&nbsp;</td></tr></tbody></table></div>
</section>
</main>


<script>
const addForm = document.getElementById('addTaskForm');
addForm.addEventListener('submit', async e=>{ e.preventDefault(); const fd=new FormData(addForm);
await fetch('/api/tasks',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(Object.fromEntries(fd)) }); addForm.reset(); loadTasks();
});


async function loadTasks(){ const res=await fetch('/api/tasks'); const data=await res.json(); renderTasks(data) }


async function delTask(id){ if(!confirm('למחוק משימה?')) return; await fetch('/api/tasks/'+id,{ method:'DELETE' }); loadTasks(); }
async function editTask(id, oldName, oldCat){ const name=prompt('שם חדש:', oldName); if(!name) return; const category=prompt('קטגוריה (daily/weekly/monthly):', oldCat)||oldCat; await fetch('/api/tasks/'+id,{ method:'PUT', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ name, category })}); loadTasks(); }


function renderTasks(tasks){ const daily=tasks.filter(t=>t.category==='daily'); const weekly=tasks.filter(t=>t.category==='weekly'); const monthly=tasks.filter(t=>t.category==='monthly');
const rows = arr => arr.map(t=>`<tr><td>${escapeHtml(t.name)}</td><td><button class="btn" onclick="editTask('${t._id}','${escapeAttr(t.name)}','${t.category}')">ערוך</button> <button class="btn danger" onclick="delTask('${t._id}')">מחק</button></td></tr>`).join('');
document.getElementById('dailyTasks').innerHTML = rows(daily) || '<tr><td colspan="2" class="muted">אין משימות</td></tr>';
document.getElementById('weeklyTasks').innerHTML = rows(weekly) || '<tr><td colspan="2" class="muted">אין משימות</td></tr>';
document.getElementById('monthlyTasks').innerHTML = rows(monthly) || '<tr><td colspan="2" class="muted">אין משימות</td></tr>';
}


function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;' }[m])) }
function escapeAttr(s){ return escapeHtml(s).replace(/"/g,'&quot;') }


loadTasks();
</script>
</body>
</html>